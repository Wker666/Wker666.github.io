<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Windows-CreateFile | Wker</title>
  <meta name="author" content="Wker">
  
  <meta name="description" content="一个萌新">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Windows-CreateFile"/>
  <meta property="og:site_name" content="Wker"/>

  
    <meta property="og:image" content=""/>
  

  
    <link rel="alternative" href="/atom.xml" title="Wker" type="application/atom+xml">
  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">  
  <link rel="stylesheet" href="/css/sidenav.css" media="screen" type="text/css">  
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  

<meta name="generator" content="Hexo 4.2.0"></head>

<body id="body" data-spy="scroll" data-target=".toc">
  <div class="container" id="container">
	<div class="content">
	  <div class="page-header">		
  <h1><a class="brand" href="/">Wker</a><span class="split"></span><span class="title">Windows-CreateFile</span><span class="date" id="title-date"><i class="fa fa-clock-o"></i> 2020-01-23</span></h1>
</div>		

<div class="row page">
  <!-- cols -->	
  
  

  
	<div class="col-md-12">
	  

	  <!-- content -->
	  <h1 id="文件操作"><a href="#文件操作" class="headerlink" title="文件操作"></a>文件操作</h1><p>这个文件操作呢其实别叫泛，调用函数的类型其实是许多的，但是最强大的那个呢还是要数<code>CreateFile</code>了。来看一下MSDN的介绍吧：<br>The CreateFile function creates or opens the following objects and returns a handle that can be used to access the object: </p>
<ul>
<li>files </li>
<li>pipes </li>
<li>mailslots </li>
<li>communications resources </li>
<li>disk devices (Windows NT only) </li>
<li>consoles </li>
<li>directories (open only) </li>
</ul>
<p>控制台，通信资源，目录（只读打开），磁盘驱动器，文件，邮槽，管道。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">HANDLE <span class="title">CreateFile</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  LPCTSTR lpFileName,          <span class="comment">// pointer to name of the file</span></span></span></span><br><span class="line"><span class="function"><span class="params">  DWORD dwDesiredAccess,       <span class="comment">// access (read-write) mode</span></span></span></span><br><span class="line"><span class="function"><span class="params">  DWORD dwShareMode,           <span class="comment">// share mode</span></span></span></span><br><span class="line"><span class="function"><span class="params">  LPSECURITY_ATTRIBUTES lpSecurityAttributes,</span></span></span><br><span class="line"><span class="function"><span class="params">                               <span class="comment">// pointer to security attributes</span></span></span></span><br><span class="line"><span class="function"><span class="params">  DWORD dwCreationDisposition,  <span class="comment">// how to create</span></span></span></span><br><span class="line"><span class="function"><span class="params">  DWORD dwFlagsAndAttributes,  <span class="comment">// file attributes</span></span></span></span><br><span class="line"><span class="function"><span class="params">  HANDLE hTemplateFile         <span class="comment">// handle to file with attributes to </span></span></span></span><br><span class="line"><span class="function"><span class="params">                               <span class="comment">// copy</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*下面中文的一个简洁*/</span></span><br><span class="line"><span class="function">HANDLE <span class="title">CreateFile</span><span class="params">(LPCTSTR lpFileName, <span class="comment">//普通文件名或者设备文件名</span></span></span></span><br><span class="line"><span class="function"><span class="params">	DWORD dwDesiredAccess, <span class="comment">//访问模式（写/读）</span></span></span></span><br><span class="line"><span class="function"><span class="params">	DWORD dwShareMode, <span class="comment">//共享模式</span></span></span></span><br><span class="line"><span class="function"><span class="params">	LPSECURITY_ATTRIBUTES lpSecurityAttributes, <span class="comment">//指向安全属性的指针</span></span></span></span><br><span class="line"><span class="function"><span class="params">	DWORD dwCreationDisposition, <span class="comment">//如何创建</span></span></span></span><br><span class="line"><span class="function"><span class="params">	DWORD dwFlagsAndAttributes, <span class="comment">//文件属性</span></span></span></span><br><span class="line"><span class="function"><span class="params">	HANDLE hTemplateFile <span class="comment">//用于复制文件句柄</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br></pre></td></tr></table></figure>
<p>其实呢，复杂归复杂，但是有一些东西我们可能很少能用到，比如说按个安全属性，基本上用不到。</p>
<ol>
<li><code>lpFileName</code>这个参数其实就是类似于路径的一个东西，<ul>
<li>文件：文件的名称</li>
<li>串口：COM1为文件名</li>
<li>服务：\.\服务名称（.代表本地机器）</li>
<li>网络上其他主机文件：\主机名\共享目录名\文件名</li>
</ul>
</li>
<li><code>dwDesiredAccess</code>这个就是文件的打开方式<ul>
<li>标准控制权限(16-23位掩码)：</li>
<li>DELETE 删除对象的权限。</li>
<li>READ_CONTROL 从对象的安全描述符中读取信息的权限，但不包括SACL(系统访问控制列表)中的信息。</li>
<li>WRITE_DAC 修改对象安全描述符中的DACL(随机访问控制列表)的权限</li>
<li>WRITE_OWNER 修改对象安全描述符中的属主的权限</li>
<li>SYNCHRONIZE 同步化使用对象的权限，即可以创建一个线程等待信号量释放(但有些对象不支持这个权限)。</li>
<li>STANDARD_RIGHTS_REQUIRED 等价于前面四种权限的总合(通常这四种是必须具有的权限)。</li>
<li>STANDARD_RIGHTS_READ 一般等价于READ_CONTROL</li>
<li>STANDARD_RIGHTS_WRITE 一般等价于READ_CONTROL</li>
<li>STANDARD_RIGHTS_EXECUTE 一般等价于READ_CONTROL</li>
<li>STANDARD_RIGHTS_ALL 等价于前面五种权限的总合。</li>
<li>特殊控制权限(0-15位掩码)：</li>
<li>SPECIFIC_RIGHTS_ALL</li>
<li>ACCESS_SYSTEM_SECURITY</li>
<li>MAXIMUM_ALLOWED</li>
<li>GENERIC_READ</li>
<li>GENERIC_WRITE</li>
<li>GENERIC_EXECUTE</li>
<li>GENERIC_ALL</li>
<li>注：实质上是通过ACCESS_MASK结构体的一个双字值来设置标准权限、特殊权限和一般权限的。</li>
</ul>
</li>
<li><code>dwShareMode</code>这个参数就是共享的方式，百度上的解释：<ul>
<li>如果是零表示不共享； 如果是FILE_SHARE_DELETE表示随后打开操作对象会成功，但只有删除访问请求的权限；如果是FILE_SHARE_READ随后打开操作对象会成功只有请求读访问的权限；如果是FILE_SHARE_WRITE 随后打开操作对象会成功，但只有请求写访问的权限。</li>
</ul>
</li>
<li><code>lpSecurityAttributes</code>这个参数就是一个指向安全属性的一个指针，这个有点乱，我一般就填写NULL，这个就是默认。</li>
<li><code>dwCreationDisposition</code>这个参数文件的状态，主要是下面这几个常量：<ul>
<li>CREATE_NEW 创建文件；如文件存在则会出错</li>
<li>CREATE_ALWAYS 创建文件，会改写前一个文件</li>
<li>OPEN_EXISTING 文件必须已经存在。由设备提出要求</li>
<li>OPEN_ALWAYS 如文件不存在则创建它</li>
<li>TRUNCATE_EXISTING 将现有文件缩短为零长度</li>
</ul>
</li>
<li><code>dwFlagsAndAttributes</code>这个参数新建文件的属性和标志，也就是下面几个常量：<br>FILE_ATTRIBUTE_ARCHIVE 标记归档属性<br>FILE_ATTRIBUTE_COMPRESSED 将文件标记为已压缩，或者标记为文件在目录中的默认压缩方式<ul>
<li>FILE_ATTRIBUTE_NORMAL 默认属性</li>
<li>FILE_ATTRIBUTE_HIDDEN 隐藏文件或目录</li>
<li>FILE_ATTRIBUTE_READONLY 文件为只读</li>
<li>FILE_ATTRIBUTE_SYSTEM 文件为系统文件</li>
<li>FILE_FLAG_WRITE_THROUGH 操作系统不得推迟对文件的写操作</li>
<li>FILE_FLAG_OVERLAPPED 允许对文件进行重叠操作</li>
<li>FILE_FLAG_NO_BUFFERING 禁止对文件进行缓冲处理。文件只能写入磁盘卷的扇区块</li>
<li>FILE_FLAG_RANDOM_ACCESS 针对随机访问对文件缓冲进行优化</li>
<li>FILE_FLAG_SEQUENTIAL_SCAN 针对连续访问对文件缓冲进行优化</li>
<li>FILE_FLAG_DELETE_ON_CLOSE 关闭了上一次打开的句柄后，将文件删除。特别适合临时文件</li>
</ul>
</li>
<li><code>hTemplateFile</code>是个文件的模板，这个参数好像已经废掉了，写个NULL就可以了。</li>
</ol>
<p>返回值的话呢，就是一个文件的句柄，接受之后就可以对其操作了，也不只是文件句柄，很多的东西呢，之后再说。</p>
<h2 id="实际操作"><a href="#实际操作" class="headerlink" title="实际操作"></a>实际操作</h2><p>为了方便起见，我就拿简单的读写文件进行演示吧，其他的都是放在后面说：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	HANDLE hFile;</span><br><span class="line">	hFile = CreateFile(<span class="string">"Wker.txt"</span>,</span><br><span class="line">					GENERIC_WRITE,<span class="comment">//要写这个文件	</span></span><br><span class="line">					<span class="number">0</span>,<span class="comment">//不共享</span></span><br><span class="line">					<span class="literal">NULL</span>,<span class="comment">//默认的安全属性</span></span><br><span class="line">					CREATE_ALWAYS,<span class="comment">//创建文件</span></span><br><span class="line">					FILE_ATTRIBUTE_NORMAL,<span class="comment">//普通文件 </span></span><br><span class="line">					<span class="literal">NULL</span>);</span><br><span class="line">	<span class="keyword">if</span>(hFile == INVALID_HANDLE_VALUE)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">cout</span>&lt;&lt;<span class="string">"打开失败，看看是不是有杀毒软件哦！"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//操作文件指针 </span></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代码简单易懂，看下就好了。</p>
	  

	  <div>
  		<center>
		  <div class="pagination">
<ul class="pagination">
	
	
	
	
	
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
			
		
	
		
			
			
			
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
	
	
		<li class="prev"><a href="/2020/01/24/File-operate/" class="alignleft prev"><i class="fa fa-arrow-circle-o-left"></i>prev</a></li>
	
	<li><a href="/"><i class="fa fa-archive"></i>Home</a></li>
	
		<li class="next"><a href="/2020/01/23/java-%E6%B3%9B%E5%9E%8B2/" class="alignright next">next<i class="fa fa-arrow-circle-o-right"></i></a></li>
	
</ul>
</div>

		</center>
	  </div>
	  
	</div> <!-- col-md-9/col-md-12 -->
	
  </div><!-- row -->

	</div>
  </div>
  <div class="container-narrow">
	<footer> <p>
  &copy; 2020 Wker
  
      with help from <a href="http://zespia.tw/hexo/" target="_blank">Hexo</a> and <a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a>. Theme by <a href="http://github.com/wzpan/hexo-theme-wixo/" target="_blank" rel="noopener">Wixo</a>.    
</p> </footer>
  </div> <!-- container-narrow -->
  
<a id="gotop" href="#">   
  <span>▲</span> 
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/jquery.tableofcontents.min.js"></script>
<script src="/js/tocgenerator.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>




</body>
</html>
